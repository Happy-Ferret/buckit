#!/bin/bash

# Get the setuptools whl for pkg_resources availability
set -e

filename="setuptools-38.5.2-py2.py3-none-any.whl"
unverified_filename="${filename}.unverified"
expected_hash="11d099932493e62db17f9bbad73318ba629f1ea0"

trap "rm -f \"$unverified_filename\"" EXIT

curl "https://pypi.python.org/packages/ad/dc/fcced9ec3f2561c0cbe8eb6527eef7cf4f4919a2b3a07891a36e846635af/setuptools-38.5.2-py2.py3-none-any.whl#md5=abd3307cdce6fb543b5a4d0e3e98bdb6" > "$unverified_filename"
sha=$(sha1sum "$unverified_filename" | awk {'print $1'})

if [ "$sha" != "$expected_hash" ]; then
  echo "Invalid sha detected for $unverified_filename Expected $expected_hash , got $sha"
  exit 1
fi
mv "$unverified_filename" "$filename"

cat > BUCK <<EOF
# Generated by get_setuptools.sh

prebuilt_python_library(
    name = "setuptools",
    binary_src = "$filename",
    visibility = ["//tests/..."],
)
EOF
